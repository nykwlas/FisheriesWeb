{"ast":null,"code":"import _objectSpread from\"/home/nicolas/FisheriesWeb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _objectWithoutProperties from\"/home/nicolas/FisheriesWeb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _classCallCheck from\"/home/nicolas/FisheriesWeb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/nicolas/FisheriesWeb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/nicolas/FisheriesWeb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/nicolas/FisheriesWeb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{connect}from'react-redux';import{compose}from'recompose';import{withFirebase}from'../Firebase';import MessageList from'./MessageList';var Messages=/*#__PURE__*/function(_Component){_inherits(Messages,_Component);var _super=_createSuper(Messages);function Messages(props){var _this;_classCallCheck(this,Messages);_this=_super.call(this,props);_this.onListenForMessages=function(){_this.props.firebase.messages().orderByChild('createdAt').limitToLast(_this.props.limit).on('value',function(snapshot){_this.props.onSetMessages(snapshot.val());_this.setState({loading:false});});};_this.onChangeText=function(event){_this.setState({text:event.target.value});};_this.onCreateMessage=function(event,authUser){_this.props.firebase.messages().push({text:_this.state.text,userId:authUser.uid,createdAt:_this.props.firebase.serverValue.TIMESTAMP});_this.setState({text:''});event.preventDefault();};_this.onEditMessage=function(message,text){var uid=message.uid,messageSnapshot=_objectWithoutProperties(message,[\"uid\"]);_this.props.firebase.message(message.uid).set(_objectSpread({},messageSnapshot,{text:text,editedAt:_this.props.firebase.serverValue.TIMESTAMP}));};_this.onRemoveMessage=function(uid){_this.props.firebase.message(uid).remove();};_this.onNextPage=function(){_this.props.onSetMessagesLimit(_this.props.limit+5);};_this.state={text:'',loading:false};return _this;}_createClass(Messages,[{key:\"componentDidMount\",value:function componentDidMount(){if(!this.props.messages.length){this.setState({loading:true});}this.onListenForMessages();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(props){if(props.limit!==this.props.limit){this.onListenForMessages();}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.props.firebase.messages().off();}},{key:\"render\",value:function render(){var _this2=this;var messages=this.props.messages;var _this$state=this.state,text=_this$state.text,loading=_this$state.loading;return/*#__PURE__*/React.createElement(\"div\",null,!loading&&messages&&/*#__PURE__*/React.createElement(\"button\",{type:\"button\",onClick:this.onNextPage},\"More\"),loading&&/*#__PURE__*/React.createElement(\"div\",null,\"Loading ...\"),messages&&/*#__PURE__*/React.createElement(MessageList,{authUser:this.props.authUser,messages:messages,onEditMessage:this.onEditMessage,onRemoveMessage:this.onRemoveMessage}),!messages&&/*#__PURE__*/React.createElement(\"div\",null,\"There are no messages ...\"),/*#__PURE__*/React.createElement(\"form\",{onSubmit:function onSubmit(event){return _this2.onCreateMessage(event,_this2.props.authUser);}},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",value:text,onChange:this.onChangeText}),/*#__PURE__*/React.createElement(\"button\",{type:\"submit\"},\"Send\")));}}]);return Messages;}(Component);var mapStateToProps=function mapStateToProps(state){return{authUser:state.sessionState.authUser,messages:Object.keys(state.messageState.messages||{}).map(function(key){return _objectSpread({},state.messageState.messages[key],{uid:key});}),limit:state.messageState.limit};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{onSetMessages:function onSetMessages(messages){return dispatch({type:'MESSAGES_SET',messages:messages});},onSetMessagesLimit:function onSetMessagesLimit(limit){return dispatch({type:'MESSAGES_LIMIT_SET',limit:limit});}};};export default compose(withFirebase,connect(mapStateToProps,mapDispatchToProps))(Messages);","map":{"version":3,"sources":["/home/nicolas/FisheriesWeb/src/components/Messages/Messages.js"],"names":["React","Component","connect","compose","withFirebase","MessageList","Messages","props","onListenForMessages","firebase","messages","orderByChild","limitToLast","limit","on","snapshot","onSetMessages","val","setState","loading","onChangeText","event","text","target","value","onCreateMessage","authUser","push","state","userId","uid","createdAt","serverValue","TIMESTAMP","preventDefault","onEditMessage","message","messageSnapshot","set","editedAt","onRemoveMessage","remove","onNextPage","onSetMessagesLimit","length","off","mapStateToProps","sessionState","Object","keys","messageState","map","key","mapDispatchToProps","dispatch","type"],"mappings":"y2BAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAASC,OAAT,KAAwB,WAAxB,CAEA,OAASC,YAAT,KAA6B,aAA7B,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,C,GAEMC,CAAAA,Q,oGACJ,kBAAYC,KAAZ,CAAmB,0CACjB,uBAAMA,KAAN,EADiB,MAuBnBC,mBAvBmB,CAuBG,UAAM,CAC1B,MAAKD,KAAL,CAAWE,QAAX,CACGC,QADH,GAEGC,YAFH,CAEgB,WAFhB,EAGGC,WAHH,CAGe,MAAKL,KAAL,CAAWM,KAH1B,EAIGC,EAJH,CAIM,OAJN,CAIe,SAAAC,QAAQ,CAAI,CACvB,MAAKR,KAAL,CAAWS,aAAX,CAAyBD,QAAQ,CAACE,GAAT,EAAzB,EAEA,MAAKC,QAAL,CAAc,CAAEC,OAAO,CAAE,KAAX,CAAd,EACD,CARH,EASD,CAjCkB,OAuCnBC,YAvCmB,CAuCJ,SAAAC,KAAK,CAAI,CACtB,MAAKH,QAAL,CAAc,CAAEI,IAAI,CAAED,KAAK,CAACE,MAAN,CAAaC,KAArB,CAAd,EACD,CAzCkB,OA2CnBC,eA3CmB,CA2CD,SAACJ,KAAD,CAAQK,QAAR,CAAqB,CACrC,MAAKnB,KAAL,CAAWE,QAAX,CAAoBC,QAApB,GAA+BiB,IAA/B,CAAoC,CAClCL,IAAI,CAAE,MAAKM,KAAL,CAAWN,IADiB,CAElCO,MAAM,CAAEH,QAAQ,CAACI,GAFiB,CAGlCC,SAAS,CAAE,MAAKxB,KAAL,CAAWE,QAAX,CAAoBuB,WAApB,CAAgCC,SAHT,CAApC,EAMA,MAAKf,QAAL,CAAc,CAAEI,IAAI,CAAE,EAAR,CAAd,EAEAD,KAAK,CAACa,cAAN,GACD,CArDkB,OAuDnBC,aAvDmB,CAuDH,SAACC,OAAD,CAAUd,IAAV,CAAmB,IACzBQ,CAAAA,GADyB,CACGM,OADH,CACzBN,GADyB,CACjBO,eADiB,0BACGD,OADH,UAGjC,MAAK7B,KAAL,CAAWE,QAAX,CAAoB2B,OAApB,CAA4BA,OAAO,CAACN,GAApC,EAAyCQ,GAAzC,kBACKD,eADL,EAEEf,IAAI,CAAJA,IAFF,CAGEiB,QAAQ,CAAE,MAAKhC,KAAL,CAAWE,QAAX,CAAoBuB,WAApB,CAAgCC,SAH5C,IAKD,CA/DkB,OAiEnBO,eAjEmB,CAiED,SAAAV,GAAG,CAAI,CACvB,MAAKvB,KAAL,CAAWE,QAAX,CAAoB2B,OAApB,CAA4BN,GAA5B,EAAiCW,MAAjC,GACD,CAnEkB,OAqEnBC,UArEmB,CAqEN,UAAM,CACjB,MAAKnC,KAAL,CAAWoC,kBAAX,CAA8B,MAAKpC,KAAL,CAAWM,KAAX,CAAmB,CAAjD,EACD,CAvEkB,CAGjB,MAAKe,KAAL,CAAa,CACXN,IAAI,CAAE,EADK,CAEXH,OAAO,CAAE,KAFE,CAAb,CAHiB,aAOlB,C,kFAEmB,CAClB,GAAI,CAAC,KAAKZ,KAAL,CAAWG,QAAX,CAAoBkC,MAAzB,CAAiC,CAC/B,KAAK1B,QAAL,CAAc,CAAEC,OAAO,CAAE,IAAX,CAAd,EACD,CAED,KAAKX,mBAAL,GACD,C,8DAEkBD,K,CAAO,CACxB,GAAIA,KAAK,CAACM,KAAN,GAAgB,KAAKN,KAAL,CAAWM,KAA/B,CAAsC,CACpC,KAAKL,mBAAL,GACD,CACF,C,mEAcsB,CACrB,KAAKD,KAAL,CAAWE,QAAX,CAAoBC,QAApB,GAA+BmC,GAA/B,GACD,C,uCAoCQ,oBACCnC,CAAAA,QADD,CACc,KAAKH,KADnB,CACCG,QADD,iBAEmB,KAAKkB,KAFxB,CAECN,IAFD,aAECA,IAFD,CAEOH,OAFP,aAEOA,OAFP,CAIP,mBACE,+BACG,CAACA,OAAD,EAAYT,QAAZ,eACC,8BAAQ,IAAI,CAAC,QAAb,CAAsB,OAAO,CAAE,KAAKgC,UAApC,SAFJ,CAOGvB,OAAO,eAAI,6CAPd,CASGT,QAAQ,eACP,oBAAC,WAAD,EACE,QAAQ,CAAE,KAAKH,KAAL,CAAWmB,QADvB,CAEE,QAAQ,CAAEhB,QAFZ,CAGE,aAAa,CAAE,KAAKyB,aAHtB,CAIE,eAAe,CAAE,KAAKK,eAJxB,EAVJ,CAkBG,CAAC9B,QAAD,eAAa,2DAlBhB,cAoBE,4BACE,QAAQ,CAAE,kBAAAW,KAAK,QACb,CAAA,MAAI,CAACI,eAAL,CAAqBJ,KAArB,CAA4B,MAAI,CAACd,KAAL,CAAWmB,QAAvC,CADa,EADjB,eAKE,6BACE,IAAI,CAAC,MADP,CAEE,KAAK,CAAEJ,IAFT,CAGE,QAAQ,CAAE,KAAKF,YAHjB,EALF,cAUE,8BAAQ,IAAI,CAAC,QAAb,SAVF,CApBF,CADF,CAmCD,C,sBAjHoBnB,S,EAoHvB,GAAM6C,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAAlB,KAAK,QAAK,CAChCF,QAAQ,CAAEE,KAAK,CAACmB,YAAN,CAAmBrB,QADG,CAEhChB,QAAQ,CAAEsC,MAAM,CAACC,IAAP,CAAYrB,KAAK,CAACsB,YAAN,CAAmBxC,QAAnB,EAA+B,EAA3C,EAA+CyC,GAA/C,CACR,SAAAC,GAAG,0BACExB,KAAK,CAACsB,YAAN,CAAmBxC,QAAnB,CAA4B0C,GAA5B,CADF,EAEDtB,GAAG,CAAEsB,GAFJ,IADK,CAFsB,CAQhCvC,KAAK,CAAEe,KAAK,CAACsB,YAAN,CAAmBrC,KARM,CAAL,EAA7B,CAWA,GAAMwC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAAAC,QAAQ,QAAK,CACtCtC,aAAa,CAAE,uBAAAN,QAAQ,QACrB4C,CAAAA,QAAQ,CAAC,CAAEC,IAAI,CAAE,cAAR,CAAwB7C,QAAQ,CAARA,QAAxB,CAAD,CADa,EADe,CAGtCiC,kBAAkB,CAAE,4BAAA9B,KAAK,QACvByC,CAAAA,QAAQ,CAAC,CAAEC,IAAI,CAAE,oBAAR,CAA8B1C,KAAK,CAALA,KAA9B,CAAD,CADe,EAHa,CAAL,EAAnC,CAOA,cAAeV,CAAAA,OAAO,CACpBC,YADoB,CAEpBF,OAAO,CACL4C,eADK,CAELO,kBAFK,CAFa,CAAP,CAMb/C,QANa,CAAf","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { compose } from 'recompose';\n\nimport { withFirebase } from '../Firebase';\nimport MessageList from './MessageList';\n\nclass Messages extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      text: '',\n      loading: false,\n    };\n  }\n\n  componentDidMount() {\n    if (!this.props.messages.length) {\n      this.setState({ loading: true });\n    }\n\n    this.onListenForMessages();\n  }\n\n  componentDidUpdate(props) {\n    if (props.limit !== this.props.limit) {\n      this.onListenForMessages();\n    }\n  }\n\n  onListenForMessages = () => {\n    this.props.firebase\n      .messages()\n      .orderByChild('createdAt')\n      .limitToLast(this.props.limit)\n      .on('value', snapshot => {\n        this.props.onSetMessages(snapshot.val());\n\n        this.setState({ loading: false });\n      });\n  };\n\n  componentWillUnmount() {\n    this.props.firebase.messages().off();\n  }\n\n  onChangeText = event => {\n    this.setState({ text: event.target.value });\n  };\n\n  onCreateMessage = (event, authUser) => {\n    this.props.firebase.messages().push({\n      text: this.state.text,\n      userId: authUser.uid,\n      createdAt: this.props.firebase.serverValue.TIMESTAMP,\n    });\n\n    this.setState({ text: '' });\n\n    event.preventDefault();\n  };\n\n  onEditMessage = (message, text) => {\n    const { uid, ...messageSnapshot } = message;\n\n    this.props.firebase.message(message.uid).set({\n      ...messageSnapshot,\n      text,\n      editedAt: this.props.firebase.serverValue.TIMESTAMP,\n    });\n  };\n\n  onRemoveMessage = uid => {\n    this.props.firebase.message(uid).remove();\n  };\n\n  onNextPage = () => {\n    this.props.onSetMessagesLimit(this.props.limit + 5);\n  };\n\n  render() {\n    const { messages } = this.props;\n    const { text, loading } = this.state;\n\n    return (\n      <div>\n        {!loading && messages && (\n          <button type=\"button\" onClick={this.onNextPage}>\n            More\n          </button>\n        )}\n\n        {loading && <div>Loading ...</div>}\n\n        {messages && (\n          <MessageList\n            authUser={this.props.authUser}\n            messages={messages}\n            onEditMessage={this.onEditMessage}\n            onRemoveMessage={this.onRemoveMessage}\n          />\n        )}\n\n        {!messages && <div>There are no messages ...</div>}\n\n        <form\n          onSubmit={event =>\n            this.onCreateMessage(event, this.props.authUser)\n          }\n        >\n          <input\n            type=\"text\"\n            value={text}\n            onChange={this.onChangeText}\n          />\n          <button type=\"submit\">Send</button>\n        </form>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  authUser: state.sessionState.authUser,\n  messages: Object.keys(state.messageState.messages || {}).map(\n    key => ({\n      ...state.messageState.messages[key],\n      uid: key,\n    }),\n  ),\n  limit: state.messageState.limit,\n});\n\nconst mapDispatchToProps = dispatch => ({\n  onSetMessages: messages =>\n    dispatch({ type: 'MESSAGES_SET', messages }),\n  onSetMessagesLimit: limit =>\n    dispatch({ type: 'MESSAGES_LIMIT_SET', limit }),\n});\n\nexport default compose(\n  withFirebase,\n  connect(\n    mapStateToProps,\n    mapDispatchToProps,\n  ),\n)(Messages);\n"]},"metadata":{},"sourceType":"module"}